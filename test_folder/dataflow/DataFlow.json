{
	"name": "DataFlow",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Destination_DB",
						"type": "DatasetReference"
					},
					"name": "SRC1"
				},
				{
					"dataset": {
						"referenceName": "Destination_DB_Datastore",
						"type": "DatasetReference"
					},
					"name": "SRC2"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "TRECON_DataStore",
						"type": "DatasetReference"
					},
					"name": "TargetTable"
				}
			],
			"transformations": [
				{
					"name": "InnerJoin"
				},
				{
					"name": "SumAmount"
				},
				{
					"name": "DerivedColumn"
				}
			],
			"script": "source(output(\n\t\tID as decimal(12,0),\n\t\tPOLICY_NR as string,\n\t\tSTATUS_ID as decimal(12,0),\n\t\tSTATUS_ATTR_ID as decimal(12,0),\n\t\tSTATUS_DATE as timestamp,\n\t\tSTATUS_COLL_DATE as timestamp,\n\t\tSTATUS_RENEWAL_ID as decimal(12,0),\n\t\tSTATUS_RENEWAL_DATE as timestamp,\n\t\tPRODUCT_VERSION_ID as decimal(12,0),\n\t\tPOLICY_PROPOSAL_DATE as timestamp,\n\t\tPOLICY_START_DATE as timestamp,\n\t\tPOLICY_END_DATE as timestamp,\n\t\tCANCEL_FROM as timestamp,\n\t\tCURRENCY_CODE as decimal(12,0),\n\t\tRANDOM_NR as decimal(12,0),\n\t\tSTATUS_RENEWAL_ATTR as decimal(12,0),\n\t\tRENEWAL_NR as decimal(12,0),\n\t\tRENEWAL_DATE as timestamp,\n\t\tSALES_1 as decimal(12,0),\n\t\tSALES_2 as decimal(12,0),\n\t\tSALES_1_DATE as timestamp,\n\t\tEDITION as string,\n\t\tUPDATE_USER as decimal(12,0),\n\t\tUPDATE_DATE as timestamp,\n\t\tACTIVE_POLICY_ID as decimal(12,0),\n\t\tMAIN_RENEWAL_DATE as timestamp,\n\t\tUPDATE_VERSION as decimal(12,0),\n\t\tATTN_ID as decimal(12,0),\n\t\tDATE_CONFIRM_POLICY as timestamp,\n\t\tCONFIRM_POLICY as string,\n\t\tMANUAL_NON_RENEWALS_CODE as decimal(12,0),\n\t\tSALES_CHANNEL as decimal(12,0),\n\t\tPAID_BY_AGENT_FLAG as decimal(12,0),\n\t\tPREVIOUS_POL_HEADER_ID as decimal(12,0),\n\t\tPREVIOUS_POL_HEADER_REASON_ID as decimal(12,0),\n\t\tPRODUCT_ID as decimal(12,0),\n\t\tTOT_AGREEMENT_TYPE_ID as decimal(12,0),\n\t\tBILLING_TYPE_ID as decimal(12,0),\n\t\tAFFINITY_ID as decimal(12,0),\n\t\tDISPLAY_PRODUCT_ID as decimal(12,0),\n\t\tIMMEDIATE_COLLECTION_DATE_FLAG as decimal(12,0),\n\t\tUPDATE_TOT_FLAG as decimal(12,0),\n\t\tHANDLING_LEVEL_ID as decimal(12,0),\n\t\tPOLICY_STATE_ID as decimal(12,0),\n\t\tPARENT_ID as decimal(12,0),\n\t\tIS_MASTER_POLICY as decimal(12,0),\n\t\tIS_IN_ENDORSEMENT_BATCH as decimal(12,0),\n\t\tEXTERNAL_HEADER_NUMBER as string,\n\t\tPOLICY_TYPE_ID as decimal(12,0),\n\t\tORIGINAL_POLICY_HEADER_ID as decimal(12,0),\n\t\tCONSOLIDATED_BILLING_FLAG as decimal(1,0),\n\t\tMULTIPLE_PAYERS_FLAG as decimal(1,0),\n\t\tLAST_TAX_RATE_APPLIED as decimal(1,0),\n\t\tHEALTH_UMBRELLA_POL_HEADER_ID as decimal(12,0),\n\t\tIS_HEALTH_UMBRELLA_POLICY as decimal(1,0),\n\t\tPRE_RENEWAL_FLAG as decimal(1,0),\n\t\tMEDICAL_QUESTIONNAIRE_STATUS as decimal(12,0),\n\t\tMEDICAL_RESTRICTIONS_COMMENTS as string,\n\t\tDERIVED_POLICY_HEADER_ID as decimal(12,0),\n\t\tLAST_ETRADE_MESSAGE_ID as decimal(12,0),\n\t\tLAST_BESPOKE_LINE_ID as decimal(12,0),\n\t\tLAST_LOB_BESPOKE_LINE_ID as decimal(12,0),\n\t\tFUTURE_CANCEL_DETAILS_ID as decimal(12,0),\n\t\tTAX_OVERRIDE_START_DATE as timestamp,\n\t\tSTANDALONE_TAX_OVERRIDE as decimal(1,0),\n\t\tHAS_PENDING_NON_RENEWAL as decimal(1,0),\n\t\tTRACK_COVER_BALANCE_PER_ENDORS as decimal(1,0),\n\t\tARCHIVE_BATCH_ID as decimal(12,0),\n\t\tARCHIVE_DATE as timestamp,\n\t\tARCHIVE_STATUS_ID as decimal(12,0),\n\t\tPROCESSING_STATUS_ID as decimal(12,0),\n\t\tMASS_ANONYMIZE as timestamp,\n\t\tBLOCKING_REASON_ID as decimal(12,0),\n\t\tEXT_DATA as string,\n\t\tBALANCE_PRIOR_CANCELATION as decimal(20,10),\n\t\tNO_PAID_AMOUNT_PRIOR_CANCEL as decimal(1,0),\n\t\tBLOCKING_ROOT as decimal(12,0)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SRC1\nsource(output(\n\t\tID as decimal(12,0),\n\t\tPOLICY_HEADER_ID as decimal(12,0),\n\t\tENDORS_NR as decimal(12,0),\n\t\tSTATUS_ID as decimal(12,0),\n\t\tSTATUS_ATTR_ID as decimal(12,0),\n\t\tSTATUS_DATE as timestamp,\n\t\tPROPOSAL_DATE as timestamp,\n\t\tENDORS_START_DATE as timestamp,\n\t\tENDORS_END_DATE as timestamp,\n\t\tYEARLY_PREMIUM as decimal(20,10),\n\t\tPREMIUM_FOR_COLL as decimal(20,10),\n\t\tSHORT_TERM_CODE as decimal(12,0),\n\t\tINDEX_RATE as decimal(20,8),\n\t\tINDEX_DATE as timestamp,\n\t\tSTORNO_DATE as timestamp,\n\t\tCURRENCY_ID as decimal(12,0),\n\t\tRATE_DATE as timestamp,\n\t\tRATE as decimal(22,10),\n\t\tYEARLY_PREMIUM_SYSTEM as decimal(20,8),\n\t\tPREMIUM_FOR_COLL_SYSTEM as decimal(20,8),\n\t\tPAYMENT_METHOD as decimal(12,0),\n\t\tPAYMENT_PLAN_ID as decimal(12,0),\n\t\tUPDATE_USER as decimal(12,0),\n\t\tUPDATE_DATE as timestamp,\n\t\tPRODUCT_VERSION_ID as decimal(12,0),\n\t\tPROPOSAL_VALIDATION as timestamp,\n\t\tUPDATE_VERSION as decimal(12,0),\n\t\tPOLICY_VERSION_NR as decimal(12,0),\n\t\tPROPOSAL_VERSION_NR as decimal(12,0),\n\t\tEXTERNAL_POLICY_NUMBER as string,\n\t\tEXTERNAL_PROPOSAL_NUMBER as string,\n\t\tENDORSMENT_TYPE_ID as decimal(12,0),\n\t\tCOLLECTION_METHOD_ID as decimal(12,0),\n\t\tPAYMENT_TERM_ID as decimal(12,0),\n\t\tPREV_ENDORSMENT_TYPE_ID as decimal(12,0),\n\t\tSTORNO_VERSION_NR as decimal(12,0),\n\t\tCANCEL_INITIATOR_ID as decimal(12,0),\n\t\tDEPT_ID as decimal(12,0),\n\t\tMAIN_RENEWAL_DATE as timestamp,\n\t\tCANCEL_METHOD_ID as decimal(12,0),\n\t\tRENEWAL_NUMBER as decimal(12,0),\n\t\tPOLICY_START_DATE as timestamp,\n\t\tPOLICY_END_DATE as timestamp,\n\t\tPREV_SUR_PAYMENT_TERM_ID as decimal(12,0),\n\t\tPREV_SUR_YEARLY_PREMIUM_FLAG as decimal(12,0),\n\t\tPREV_SUR_PREMIUM as decimal(12,0),\n\t\tGUARANTEE_DISCOUNT_PERCENT as decimal(20,8),\n\t\tFUTURE_RATE_FLAG as decimal(12,0),\n\t\tFUTURE_RATE_DATE as timestamp,\n\t\tORIGINAL_CHANNEL_ID as decimal(12,0),\n\t\tCURRENT_CHANNEL_ID as decimal(12,0),\n\t\tBILLING_TYPE_ID as decimal(12,0),\n\t\tRENEWAL_BATCH_DATE as timestamp,\n\t\tRENEWAL_BATCH_NUMBER as string,\n\t\tRETAIN_TARIF_ON_RENEWAL as decimal(12,0),\n\t\tRENEWAL_DATE as timestamp,\n\t\tAFFINITY_ID as decimal(12,0),\n\t\tREMARKS as string,\n\t\tSPLIT_PFC_BETWEEN_INSTALLMENTS as decimal(12,0),\n\t\tPRODUCT_AGENT_TOT_VERSION_ID as decimal(12,0),\n\t\tATTN_ID as decimal(12,0),\n\t\tAGENT_ACCOUNT_ID as decimal(12,0),\n\t\tHANDLING_LEVEL as decimal(12,0),\n\t\tPOLICY_PERIOD_ID as decimal(12,0),\n\t\tCONTRACT_PERIOD_ID as decimal(12,0),\n\t\tCONTRACT_END_DATE as timestamp,\n\t\tREINSURANCE_FLAG as decimal(12,0),\n\t\tPOLICY_OWNER_BANK_ACCOUNT_ID as decimal(12,0),\n\t\tADDRESSEE_TYPE_ID as decimal(12,0),\n\t\tREINSURANCE_CONTRACT_END_DATE as timestamp,\n\t\tCUSTOMER_DECISION_ID as decimal(12,0),\n\t\tTECHNICAL_COMMENTCEMENT_DATE as timestamp,\n\t\tPREMIUM_INDEX as decimal(20,8),\n\t\tPREMIUM_EXTRA_INDEX as decimal(20,8),\n\t\tUNDERWRITER_REASON_ID as decimal(12,0),\n\t\tUNDERWRITER_DECISION_ID as decimal(12,0),\n\t\tAGENT_ID as decimal(12,0),\n\t\tFIRST_YEAR_NET_PREMIUM_AMT_ID as decimal(12,0),\n\t\tBASIS_NET_PREMIUM_AMT_ID as decimal(12,0),\n\t\tEXTRA_INDEXATION_DECISION_ID as decimal(12,0),\n\t\tIS_PREMIUM_TO_COLLECT as decimal(12,0),\n\t\tIS_MASTER_POLICY as decimal(12,0),\n\t\tIS_STAND_ALLONE_FLEET_POLICY as decimal(12,0),\n\t\tPOLICY_INSURANCE_TYPE_ID as decimal(12,0),\n\t\tCOMPANY_SHARE_PERCENT as decimal(20,10),\n\t\tCHANNEL_TYPE_ID as decimal(12,0),\n\t\tMASTER_VERSION_ID as decimal(12,0),\n\t\tPOLICY_ADJUSTMENT_PERCENT as decimal(20,10),\n\t\tDOWN_PAYMENT_CALC_TYPE_ID as decimal(12,0),\n\t\tINSTALLMENT_DUE_DAY as decimal(12,0),\n\t\tPAYMENT_PLAN_ROUNDING_TYPE_ID as decimal(12,0),\n\t\tACTION_FEE_SPLIT_TYPE_ID as decimal(12,0),\n\t\tBRAND_COMPANY as decimal(12,0),\n\t\tIS_EARNED_PREM_PROCESS_RUN as decimal(12,0),\n\t\tPREFERRED_DELIVERY_TYPE_ID as decimal(12,0),\n\t\tPREFERRED_DELIVERY_ADDRESS_ID as decimal(12,0),\n\t\tMASTER_POLICY_ENDORS_ID as decimal(12,0),\n\t\tREPLACE_ALL_INSURED_PERSONS as decimal(1,0),\n\t\tREFUND_COLLECTION_METHOD_ID as decimal(12,0),\n\t\tREFUND_BANK_ACCOUNT_ID as decimal(12,0),\n\t\tMASTER_HEADER_ID as decimal(12,0),\n\t\tDOC_RECEIPT_HEADER_ID as decimal(12,0),\n\t\tCONFIRM_MASTER_ID as decimal(12,0),\n\t\tCOINS_LEAD_OFFICE_COMM_PERCENT as decimal(12,0),\n\t\tCOINSURANCE_COLL_ARR_ID as decimal(12,0),\n\t\tCOINSURANCE_LEAD_POLICY_NUMBER as string,\n\t\tTAX_RATE_CHANGED as decimal(1,0),\n\t\tPREM_ADJUSTMENT_TYPE_ID as decimal(12,0),\n\t\tPREMIUM_ADJUSTMENT_VALUE as decimal(20,10),\n\t\tREIMBURSEMENT_BANK_ACCOUNT_ID as decimal(12,0),\n\t\tREIMBURSEMENT_COLL_METHOD_ID as decimal(12,0),\n\t\tCOMBINED_HEADER_ID as decimal(12,0),\n\t\tPREMIUM_CONTRIBUTOR_ID as decimal(12,0),\n\t\tHEALTH_UMBRELLA_POL_HEADER_ID as decimal(12,0),\n\t\tAFFILIATION_REASON_ID as decimal(12,0),\n\t\tMEDICAL_QUES_STATUS_ID as decimal(12,0),\n\t\tDEPOSIT_AMOUNT as decimal(20,10),\n\t\tDEPOSIT_DUE_DATE as timestamp,\n\t\tSOURCE_POLICY_ID as decimal(12,0),\n\t\tCREATION_DATE as timestamp,\n\t\tDISCOUNT_PERCENT as decimal(20,10),\n\t\tORIGIN_PROPOSAL_ID as decimal(12,0),\n\t\tPREFERRED_COLLECTION_DAY as decimal(12,0),\n\t\tUW_DECISION_UPDATE_DATE as timestamp,\n\t\tUW_DECISION_REMARKS as string,\n\t\tUW_DECISION_USER_ID as decimal(12,0),\n\t\tCOEFFICIENT_VERSION_NR as decimal(12,0),\n\t\tPARENT_COEFFICIENT_VERSION_NR as decimal(12,0),\n\t\tINDEX_CALC_DATE as timestamp,\n\t\tINSURANCE_PLAN_ID as decimal(12,0),\n\t\tIS_FOLLOW_MASTER_PMNT_TERMS as decimal(1,0),\n\t\tIS_SUB_GROUP_ENDORSEMENT as decimal(1,0),\n\t\tCOLLECTIVE_ID as decimal(12,0),\n\t\tCOLLECTIVE_VERSION_ID as decimal(12,0),\n\t\tIS_PLAN_FOR_ADD_PREM as decimal(1,0),\n\t\tIS_SENT_TO_RI as decimal(1,0),\n\t\tPOST_RENEWAL_NR as decimal(12,0),\n\t\tIS_POST_RENEWAL as decimal(1,0),\n\t\tIS_POST_RENEWAL_FINISH as decimal(1,0),\n\t\tLOCKING_COMM_OVERRIDE_ID as decimal(12,0),\n\t\tLATEST_APPLIED_COMM_OVER_ID as decimal(12,0),\n\t\tLOCKING_REINS_OVERRIDE_ID as decimal(12,0),\n\t\tLATEST_CHANGED_REINS_ID as decimal(12,0),\n\t\tGROUP_POLICY as decimal(1,0),\n\t\tSUB_UNIT_POLICY as decimal(1,0),\n\t\tGROUP_AGRMNT_ID as decimal(12,0),\n\t\tSUB_AGRMNT_ID as decimal(12,0),\n\t\tGROUP_AGR_VERSION_ID as decimal(12,0),\n\t\tSUB_AGR_VERSION_ID as decimal(12,0),\n\t\tSUB_UNIT_ID as decimal(12,0),\n\t\tIS_PREMIUM_CALCULATED as decimal(1,0),\n\t\tPOL_ISSUANCE_TYPE_ID as decimal(12,0),\n\t\tEXT_DATA as string,\n\t\tMEMBER_TYPE_ID as decimal(12,0),\n\t\tASSOCIATED_INS_TYPE_ID as decimal(12,0),\n\t\tREPLACED_POLICY_ID as decimal(12,0),\n\t\tIS_SKELETON_EVALUATED as decimal(1,0),\n\t\tPYMT_SCHEDULER_JSON as string,\n\t\tIS_UNDER_CONSTRUCTION as decimal(1,0),\n\t\tCHECKOUT_ID as decimal(12,0)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SRC2\nSRC1, SRC2 join(ACTIVE_POLICY_ID == SRC2@ID,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> InnerJoin\nDerivedColumn aggregate(groupBy(Month_Year,\n\t\tBusiness_Area,\n\t\tKPI_Name),\n\tKPI_Value = sum(YEARLY_PREMIUM)) ~> SumAmount\nInnerJoin derive(Month_Year = '0'+toString(month(currentDate()))+'-'+ toString(year(currentDate())),\n\t\tBusiness_Area = 'Contract',\n\t\tKPI_Name = 'Total Annualized premium Inforce Policies') ~> DerivedColumn\nSumAmount sink(input(\n\t\tACTIVE_POLICY_ID as decimal(12,0),\n\t\tKPI_Value as decimal(30,10),\n\t\tDATE as date,\n\t\tKPI_Name as string,\n\t\t{Business Area} as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> TargetTable"
		}
	}
}